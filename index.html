<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Chuy·ªÉn ƒë·ªïi Excel ASC (N√¢ng cao)</title>
    <style>
        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; padding: 30px; max-width: 700px; margin: 0 auto; background-color: #f0f2f5; }
        h2 { color: #333; text-align: center; }
        .container { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-bottom: 8px; color: #555; }
        textarea { width: 100%; height: 120px; margin-bottom: 5px; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; resize: vertical; }
        textarea:focus { border-color: #007bff; outline: none; }
        
        .btn-group { text-align: right; margin-top: 15px; }
        button { padding: 10px 24px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 15px; font-weight: 600; transition: background 0.2s; }
        button:hover { background-color: #0056b3; }
        button.secondary { background-color: #6c757d; margin-right: 10px; }
        button.secondary:hover { background-color: #5a6268; }

        #status { display: inline-block; margin-right: 15px; font-size: 0.9em; font-weight: 500; }
        .arrow-icon { text-align: center; margin: 10px 0; color: #aaa; }
        
        /* CSS cho tin nh·∫Øn c·∫£nh b√°o */
        #warning-msg {
            color: #dc3545; /* M√†u ƒë·ªè */
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 5px;
            min-height: 20px; /* Gi·ªØ ch·ªó ƒë·ªÉ kh√¥ng b·ªã gi·∫≠t giao di·ªán */
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Chuy·ªÉn ƒë·ªïi Full-width sang Half-width</h2>
        <p style="text-align: center; color: #666; font-size: 0.9em;">(Have a nice day~)</p>
        
        <label for="inputText">Nh·∫≠p text Ti·∫øng Nh·∫≠t / Full-width:</label>
        <textarea id="inputText" placeholder="V√≠ d·ª•: ÔºëÔºíÔºì , Ôº°Ôº¢Ôº£„ÄÄ„ÄÄ„Ç¢„Ç§„Ç¶„Ç®„Ç™"></textarea>

        <div class="arrow-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
        </div>

        <label for="outputText">K·∫øt qu·∫£ (ƒê√£ convert):</label>
        <textarea id="outputText" readonly placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªán ·ªü ƒë√¢y..."></textarea>
        
        <div id="warning-msg"></div>

        <div class="btn-group">
            <span id="status"></span>
            <button class="secondary" onclick="clearText()">X√≥a</button>
            <button onclick="copyToClipboard()">Sao ch√©p k·∫øt qu·∫£</button>
        </div>
    </div>

    <script>
        const katakanaMap = {
            '„ÄÇ': 'ÔΩ°', '„ÄÅ': 'ÔΩ§', '„Äå': 'ÔΩ¢', '„Äç': 'ÔΩ£', '„Éª': 'ÔΩ•',
            '„Ç°': 'ÔΩß', '„Ç¢': 'ÔΩ±', '„Ç£': 'ÔΩ®', '„Ç§': 'ÔΩ≤', '„Ç•': 'ÔΩ©', '„Ç¶': 'ÔΩ≥',
            '„Çß': 'ÔΩ™', '„Ç®': 'ÔΩ¥', '„Ç©': 'ÔΩ´', '„Ç™': 'ÔΩµ',
            '„Ç´': 'ÔΩ∂', '„Ç¨': 'ÔΩ∂Ôæû', '„Ç≠': 'ÔΩ∑', '„ÇÆ': 'ÔΩ∑Ôæû', '„ÇØ': 'ÔΩ∏', '„Ç∞': 'ÔΩ∏Ôæû',
            '„Ç±': 'ÔΩπ', '„Ç≤': 'ÔΩπÔæû', '„Ç≥': 'ÔΩ∫', '„Ç¥': 'ÔΩ∫Ôæû',
            '„Çµ': 'ÔΩª', '„Ç∂': 'ÔΩªÔæû', '„Ç∑': 'ÔΩº', '„Ç∏': 'ÔΩºÔæû',
            '„Çπ': 'ÔΩΩ', '„Ç∫': 'ÔΩΩÔæû', '„Çª': 'ÔΩæ', '„Çº': 'ÔΩæÔæû',
            '„ÇΩ': 'ÔΩø', '„Çæ': 'ÔΩøÔæû',
            '„Çø': 'ÔæÄ', '„ÉÄ': 'ÔæÄÔæû', '„ÉÅ': 'ÔæÅ', '„ÉÇ': 'ÔæÅÔæû',
            '„ÉÉ': 'ÔΩØ', '„ÉÑ': 'ÔæÇ', '„ÉÖ': 'ÔæÇÔæû',
            '„ÉÜ': 'ÔæÉ', '„Éá': 'ÔæÉÔæû', '„Éà': 'ÔæÑ', '„Éâ': 'ÔæÑÔæû',
            '„Éä': 'ÔæÖ', '„Éã': 'ÔæÜ', '„Éå': 'Ôæá', '„Éç': 'Ôæà', '„Éé': 'Ôæâ',
            '„Éè': 'Ôæä', '„Éê': 'ÔæäÔæû', '„Éë': 'ÔæäÔæü',
            '„Éí': 'Ôæã', '„Éì': 'ÔæãÔæû', '„Éî': 'ÔæãÔæü',
            '„Éï': 'Ôæå', '„Éñ': 'ÔæåÔæû', '„Éó': 'ÔæåÔæü',
            '„Éò': 'Ôæç', '„Éô': 'ÔæçÔæû', '„Éö': 'ÔæçÔæü',
            '„Éõ': 'Ôæé', '„Éú': 'ÔæéÔæû', '„Éù': 'ÔæéÔæü',
            '„Éû': 'Ôæè', '„Éü': 'Ôæê', '„É†': 'Ôæë', '„É°': 'Ôæí', '„É¢': 'Ôæì',
            '„É§': 'Ôæî', '„É¶': 'Ôæï', '„É®': 'Ôæñ',
            '„É£': 'ÔΩ¨', '„É•': 'ÔΩ≠', '„Éß': 'ÔΩÆ',
            '„É©': 'Ôæó', '„É™': 'Ôæò', '„É´': 'Ôæô', '„É¨': 'Ôæö', '„É≠': 'Ôæõ',
            '„ÉØ': 'Ôæú', '„É≤': 'ÔΩ¶', '„É≥': 'Ôæù',
            '„É¥': 'ÔΩ≥Ôæû', '„Éµ': 'ÔΩ∂', '„É∂': 'ÔΩπ',
            '„Éº': 'ÔΩ∞', '„Çõ': 'Ôæû', '„Çú': 'Ôæü',
            '„ÄÄ': ' '
        };

        const input = document.getElementById('inputText');
        const output = document.getElementById('outputText');
        const status = document.getElementById('status');
        const warningMsg = document.getElementById('warning-msg'); // L·∫•y th·∫ª div c·∫£nh b√°o

        function toHalfWidth(str) {
            return str
                // 1. Katakana full-width ‚Üí half-width
                .replace(/[„ÄÅ„ÄÇ„Ç°-„É∫„Éª„Éº„Çõ„Çú]/g, ch => katakanaMap[ch] || ch)

                // 2. Full-width space (kho·∫£ng tr·∫Øng to) -> kho·∫£ng tr·∫Øng th∆∞·ªùng
                .replace(/„ÄÄ/g, ' ')

                // 3. Full-width ASCII (!ÔΩû) -> Half-width
                .replace(/[ÔºÅ-ÔΩû]/g, ch =>
                    String.fromCharCode(ch.charCodeAt(0) - 0xFEE0)
                )

                // [M·ªöI 1] Thay d·∫•u ph·∫©y ti·∫øng Anh "," th√†nh d·∫•u ph·∫©y Nh·∫≠t half-width "ÔΩ§"
                .replace(/,/g, 'ÔΩ§')

                // [M·ªöI 2] X√≥a kho·∫£ng tr·∫Øng ·ªü ƒë·∫ßu v√† cu·ªëi chu·ªói (Trim)
                .trim();
        }

        input.addEventListener('input', function () {
    const result = toHalfWidth(input.value);
    output.value = result;
    status.textContent = "";

    let warnings = [];

    // RULE A: 2 d·∫•u c√°ch li√™n ti·∫øp
    if (result.includes("  ")) {
        warnings.push("‚ö†Ô∏è [FORMAT] C√≥ 2 d·∫•u c√°ch li√™n ti·∫øp");
    }

    // RULE B: 'ÔΩ∞' d√πng sai (c·∫•m trong m√£ k·ªπ thu·∫≠t)
    if (/[A-Za-z0-9]ÔΩ∞|ÔΩ∞[A-Za-z0-9]/.test(result)) {
        warnings.push("üö´ [DRAWING] 'ÔΩ∞' kh√¥ng ƒë∆∞·ª£c d√πng l√†m d·∫•u n·ªëi trong m√£ k·ªπ thu·∫≠t");
    }

    // RULE C (ƒê√É GI·ªöI H·∫†N): '-' ch·ªâ sai khi n·ªëi ch·ªØ Nh·∫≠t ‚Äì ch·ªØ Nh·∫≠t
    if (/[ÔΩ¶-Ôæü‰∏Ä-ÈæØ]-[ÔΩ¶-Ôæü‰∏Ä-ÈæØ]/.test(result)) {
        warnings.push("üö´ [DRAWING] '-' ƒëang ƒë∆∞·ª£c d√πng ƒë·ªÉ n·ªëi t·ª´ ti·∫øng Nh·∫≠t (kh√¥ng ph√π h·ª£p)");
    }

    // Hi·ªÉn th·ªã c·∫£nh b√°o
    if (warnings.length > 0) {
        warningMsg.innerHTML = warnings.join("<br>");
        warningMsg.style.display = "block";
    } else {
        warningMsg.textContent = "";
        warningMsg.style.display = "none";
    }
});
        
        function clearText() {
            input.value = "";
            output.value = "";
            input.focus();
            status.textContent = "";
            
            // X√≥a lu√¥n c·∫£nh b√°o khi clear
            warningMsg.textContent = "";
            warningMsg.style.display = "none";
        }

        function copyToClipboard() {
            if (!output.value) return;
            output.select();
            output.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(output.value).then(() => {
                status.textContent = "ƒê√£ copy th√†nh c√¥ng! ‚úÖ";
                status.style.color = "#28a745";
                setTimeout(() => status.textContent = "", 2000);
            }).catch(err => {
                status.textContent = "L·ªói khi copy!";
                status.style.color = "red";
            });
        }
    </script>
</body>
</html>
